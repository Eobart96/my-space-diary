# 🏗️ Архитектура локальной системы синхронизации

## 📋 Общая архитектура

```
┌─────────────────────────────────────────────────────────────────┐
│                    Локальная сеть (LAN)                         │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │   ПК #1     │    │   ПК #2     │    │  Android    │         │
│  │             │    │             │    │  Устройство  │         │
│  │ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │         │
│  │ │ React   │ │    │ │ React   │ │    │ │ React   │ │         │
│  │ │ SPA     │ │    │ │ SPA     │ │    │ │ SPA     │ │         │
│  │ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │         │
│  │      │        │       │        │       │        │         │
│  │ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │         │
│  │ │ Go Sync │ │    │ │ Go Sync │ │    │ │ Go Sync │ │         │
│  │ │ Engine  │ │    │ │ Engine  │ │    │ │ Engine  │ │         │
│  │ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │         │
│  │      │        │       │        │       │        │         │
│  │ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │         │
│  │ │ Local   │ │    │ │ Local   │ │    │ │ Local   │ │         │
│  │ │ DB      │ │    │ │ DB      │ │    │ │ DB      │ │         │
│  │ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │             │
│  mDNS Discovery + WebSocket Sync (шифрованный)                │
└─────────────────────────────────────────────────────────────────┘
```

## 🔄 Процесс синхронизации

1. **Запуск**: Go-демон стартует при запуске приложения
2. **Discovery**: mDNS анонсирует и ищет другие устройства
3. **Handshake**: Обмен криптографическими идентификаторами
4. **Sync**: Установление WebSocket соединения и обмен данными
5. **Conflict Resolution**: Версионирование и разрешение конфликтов

## 🎯 Ключевые решения

- **Ed25519**: Максимальная безопасность и производительность
- **mDNS**: Автоматическое обнаружение без конфигурации
- **WebSocket**: Real-time синхронизация с минимальной задержкой
- **CRDT**: Конфликт-free replicated data types для разрешения конфликтов
- **Local-first**: Офлайн-first подход с локальной БД

## 🔒 Безопасность

- Приватный ключ никогда не покидает устройство
- Все соединения шифруются (TLS 1.3)
- Криптографическая идентификация каждого устройства
- Защита от MITM атак в локальной сети
